
<%= provide(:title, @contest.name) %>
<% if @contest.logo.attached? %>
<div class="columns">
  <div class="column">
    <%=image_tag @contest.logo.variant(resize_to_limit: [200, 200]) if @contest.logo.attached? %>
  </div>
  <div class="column">
<% end %>
    <h1 class="title"><%= @contest.name %></h1>
<% if @contest.logo.attached? %>
  </div>
</div>
<% end %>
<h2 class="subtitle">Il grafico</h2>
<%= line_chart Photo.where(contest: @contest).group_by_day(:photodate).count, xmin: "#{DateTime.now.strftime('%Y')}-09-01", xmax: "#{DateTime.now.strftime('%Y')}-09-30"%>
<br />
<h2 class="subtitle">La classifica degli utenti</h2>

<table class="table is-striped">
  <thead>
    <th>Nome utente</th>
    <th>Foto caricate</th>
    <th>Foto usate su wiki</th>
    <th>Data di iscrizione (iscritto per WLM)</th>
  </thead>
  <tbody>
    <% @creators.each do |creator| %>
      <tr>
        <td><%= link_to creator.username, creator %></td>
        <td><%= creator.photos.where(contest: @contest).count %></td>
        <td><%= creator.photos.where(contest: @contest, usedonwiki: true).count %> (<%= (creator.photos.where(contest: @contest, usedonwiki: true).count.to_f / creator.photos.where(contest: @contest).count.to_f * 100.0).truncate(1) %>%)</td>
        <td><%= creator.creationdate.strftime('%d/%m/%Y') unless creator.creationdate.nil? %> (<%= creator.proveniencecontest == @contest.id ? 'SÃ¬' : 'No' %>)</td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="buttons is-centered">
  <%= link_to 'Categoria delle foto caricate', "https://commons.wikimedia.org/wiki/#{@contest.category}", class: 'button is-link is-big' %>
  <%= link_to 'Pagina ufficiale del concorso', @contest.url, class: 'button is-danger is-big' %>
</div>

<br />

<br />
<% if Creator.where(proveniencecontest: @contest.id).count > 0 %>
  <h2 class="subtitle">Utenti iscritti appositamente per WLM</h2>
  <%= line_chart Creator.where(proveniencecontest: @contest.id).group_by_day(:creationdate).count, xmin:  "#{DateTime.now.strftime('%Y')}-09-01", xmax:  "#{DateTime.now.strftime('%Y')}-09-30"%>
<% end %>

<p><b>Nome della categoria:</b> <%= @contest.category %></p>